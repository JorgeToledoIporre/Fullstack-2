
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Administracion</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
        <link rel="stylesheet" href="../CSS/style.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Lato&family=Pacifico&display=swap" rel="stylesheet">

    </head>
    <body class="admin-page">

        <!--Menu-->
        <div class="sidebar d-flex flex-column justify-content-between"><!--d-flex flex-column convierte la sidebar en un contenedor vertical y justify-content-between separa los dos bloques hacia arriba y hacia abajo-->
            <nav class="nav flex-column flex-grow-1">  <!--flex-grow-1 lo convierte responsivo, hace que se reparta bien en la pantalla-->

                <!--company-->
                <a class="nav-link" href="homeAdmin.html">
                    <i class="bi bi-cake2"></i>
                    PMS
                </a>
                <hr class="sidebar-divider" style="color: #fff;">
                <!--Links arriba-->
                <div class="flex-grow-1"> <!--se encarga de empujar el resto hacia abajo-->
                    <a href="#" class="nav-link">
                        <span class="icon">
                            <i class="bi bi-grid"></i>
                        </span>
                        <span class="description">Dashboard</span>
                    </a>
                    <a href="#" class="nav-link">
                        <span class="icon">
                            <i class="bi bi-box-seam"></i>
                        </span>
                        <span class="description">Orders</span>
                    </a>
                    <a href="adminProductos.html" class="nav-link">
                        <span class="icon">
                            <i class="bi bi-boxes"></i>
                        </span>
                        <span class="description">inventory</span>
                    </a>
                    <a href="#" class="nav-link">
                        <span class="icon">
                            <i class="bi bi-flag"></i>
                        </span>
                        <span class="description">Reports</span>
                    </a>
                    <a href="usuarios.html" class="nav-link">
                        <span class="icon">
                            <i class="bi bi-person"></i>
                        </span>
                        <span class="description">Employees</span>
                    </a>
                    <a href="usuarios.html" class="nav-link">
                        <span class="icon">
                            <i class="bi bi-person-add"></i>
                        </span>
                        <span class="description">Customers</span>
                    </a>
                </div>

                <!-- Links abajo -->
                <div>
                    <a href="#" class="nav-link">
                        <span class="icon">
                            <i class="bi bi-gear"></i>
                        </span>
                        <span class="description">Settings</span>
                    </a>
                    <a href="#" class="nav-link">
                        <span class="icon">
                            <i class="bi bi-person-gear"></i>
                        </span>
                        <span class="description">Profile</span>
                    </a>
                    <a href="#" class="nav-link">
                        <span class="icon">
                            <i class="bi bi-search"></i>
                        </span>
                        <span class="description">Search</span>
                    </a>
                    <a href="#" class="nav-link">
                        <span class="icon">
                            <i class="bi bi-patch-question"></i>
                        </span>
                        <span class="description">Help</span>
                    </a>
                </div>
                <hr class="sidebar-divider" style="color: #fff;">
                <!--Perfil-->
                <a class="nav-link" href="#">
                    <i class="bi bi-person-circle"></i>
                    Perfil
                </a>
            </nav>
        </div>

   <main class="main-admin p-4">
        <h2>Nuevo Usuario</h2>
        <form id="formUsuario" class="mt-3">
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">RUN *</label>
                    <input type="text" class="form-control" placeholder="RUN sin puntos ni guión (ej: 19011022K)" required>
                    <small class="text-muted">Entre 7 y 9 caracteres, sin puntos ni guión</small>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Tipo de Usuario *</label>
                    <select class="form-select" required>
                        <option value="">Seleccione tipo</option>
                        <option value="Administrador">Administrador</option>
                        <option value="Cliente">Cliente</option>
                        <option value="Vendedor">Vendedor</option>
                    </select>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Nombre *</label>
                    <input type="text" class="form-control" placeholder="Ingrese nombre" required>
                    <small class="text-muted">Máximo 50 caracteres</small>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Apellidos *</label>
                    <input type="text" class="form-control" placeholder="Ingrese apellidos" required>
                    <small class="text-muted">Máximo 100 caracteres</small>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Email *</label>
                    <input type="email" class="form-control" placeholder="ejemplo@duoc.cl" required>
                    <small class="text-muted">Solo @duoc.cl, @profesor.duoc.cl o @gmail.com</small>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Fecha de Nacimiento</label>
                    <input type="date" class="form-control">
                    <small class="text-muted">Opcional</small>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Región *</label>
                    <select class="form-select" id="selectRegion" onchange="cargarComunas(this.value)">
                        <option value="">Seleccione región</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Comuna *</label>
                    <select class="form-select" id="selectComuna">
                        <option value="">Seleccione comuna</option>
                    </select>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">Dirección *</label>
                <input type="text" class="form-control" placeholder="Ingrese dirección" required>
                <small class="text-muted">Máximo 300 caracteres</small>
            </div>

            <button type="submit" class="btn btn-success">Registrar Usuario</button>
        </form>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
 <script>
        // Arrays de regiones y comunas
        const regionesComunas = {
            "Arica y Parinacota": ["Arica", "Putre", "General Lagos", "Camarones"],
            "Tarapacá": ["Iquique", "Alto Hospicio", "Pozo Almonte", "Camiña", "Colchane", "Huara", "Pica"],
            "Antofagasta": ["Antofagasta", "Mejillones", "Sierra Gorda", "Taltal", "Calama", "Ollagüe", "San Pedro de Atacama", "Tocopilla", "María Elena"],
            "Atacama": ["Copiapó", "Caldera", "Tierra Amarilla", "Chañaral", "Diego de Almagro", "Vallenar", "Alto del Carmen", "Freirina", "Huasco"],
            "Coquimbo": ["La Serena", "Coquimbo", "Andacollo", "La Higuera", "Paiguano", "Vicuña", "Illapel", "Canela", "Los Vilos", "Salamanca", "Ovalle", "Combarbalá", "Monte Patria", "Punitaqui", "Río Hurtado"],
            "Valparaíso": ["Valparaíso", "Casablanca", "Concón", "Juan Fernández", "Puchuncaví", "Quintero", "Viña del Mar", "Isla de Pascua", "Los Andes", "Calle Larga", "Rinconada", "San Esteban", "La Ligua", "Cabildo", "Papudo", "Petorca", "Zapallar", "Hijuelas", "La Calera", "La Cruz", "Limache", "Nogales", "Olmué", "Quillota", "Villa Alemana", "Quilpué", "San Antonio", "Algarrobo", "Cartagena", "El Quisco", "El Tabo", "Santo Domingo"],
            "Metropolitana": ["Santiago", "Cerrillos", "Cerro Navia", "Conchalí", "El Bosque", "Estación Central", "Huechuraba", "Independencia", "La Cisterna", "La Florida", "La Granja", "La Pintana", "La Reina", "Las Condes", "Lo Barnechea", "Lo Espejo", "Lo Prado", "Macul", "Maipú", "Ñuñoa", "Pedro Aguirre Cerda", "Peñalolén", "Providencia", "Pudahuel", "Quilicura", "Quinta Normal", "Recoleta", "Renca", "San Joaquín", "San Miguel", "San Ramón", "Vitacura"],
            "Biobío": ["Concepción", "Coronel", "Chiguayante", "Florida", "Hualqui", "Lota", "Penco", "San Pedro de la Paz", "Santa Juana", "Talcahuano", "Tomé", "Hualpén"]
        };

        // Función para validar RUT chileno
        function validarRut(rut) {
            rut = rut.replace(/[.-]/g, '').toUpperCase();
            
            if (rut.length < 7 || rut.length > 9) {
                return false;
            }
            
            const numero = rut.slice(0, -1);
            const dv = rut.slice(-1);
            
            let suma = 0;
            let multiplicador = 2;
            
            for (let i = numero.length - 1; i >= 0; i--) {
                suma += parseInt(numero[i]) * multiplicador;
                multiplicador = multiplicador === 7 ? 2 : multiplicador + 1;
            }
            
            const resto = suma % 11;
            const dvCalculado = resto === 0 ? '0' : resto === 1 ? 'K' : (11 - resto).toString();
            
            return dv === dvCalculado;
        }

        // Función para validar email
        function validarEmail(email) {
            const dominiosValidos = ['@duoc.cl', '@profesor.duoc.cl', '@gmail.com'];
            return dominiosValidos.some(dominio => email.endsWith(dominio));
        }

        // Cargar regiones al iniciar
        document.addEventListener('DOMContentLoaded', function() {
            const selectRegion = document.getElementById('selectRegion');
            Object.keys(regionesComunas).forEach(region => {
                const option = document.createElement('option');
                option.value = region;
                option.textContent = region;
                selectRegion.appendChild(option);
            });

            // Validaciones del formulario
            const form = document.getElementById('formUsuario');
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const run = document.querySelector('input[placeholder*="RUN"]').value;
                const nombre = document.querySelector('input[placeholder="Ingrese nombre"]').value;
                const apellidos = document.querySelector('input[placeholder="Ingrese apellidos"]').value;
                const email = document.querySelector('input[type="email"]').value;
                const tipoUsuario = document.querySelector('select').value;
                const direccion = document.querySelector('input[placeholder="Ingrese dirección"]').value;
                
                let errores = [];
                
                // Validaciones según requerimientos
                if (!run.trim()) {
                    errores.push('RUN es requerido');
                } else if (run.length < 7 || run.length > 9) {
                    errores.push('RUN debe tener entre 7 y 9 caracteres');
                } else if (!validarRut(run)) {
                    errores.push('RUN no es válido');
                }
                
                if (!nombre.trim()) {
                    errores.push('Nombre es requerido');
                } else if (nombre.length > 50) {
                    errores.push('Nombre no puede exceder 50 caracteres');
                }
                
                if (!apellidos.trim()) {
                    errores.push('Apellidos son requeridos');
                } else if (apellidos.length > 100) {
                    errores.push('Apellidos no pueden exceder 100 caracteres');
                }
                
                if (!email.trim()) {
                    errores.push('Email es requerido');
                } else if (email.length > 100) {
                    errores.push('Email no puede exceder 100 caracteres');
                } else if (!validarEmail(email)) {
                    errores.push('Email debe terminar en @duoc.cl, @profesor.duoc.cl o @gmail.com');
                }
                
                if (!tipoUsuario) {
                    errores.push('Tipo de usuario es requerido');
                }
                
                if (!direccion.trim()) {
                    errores.push('Dirección es requerida');
                } else if (direccion.length > 300) {
                    errores.push('Dirección no puede exceder 300 caracteres');
                }
                
                // Mostrar errores o éxito
                if (errores.length > 0) {
                    alert('Errores encontrados:\n' + errores.join('\n'));
                } else {
                    alert('Usuario registrado correctamente');
                    form.reset();
                    document.getElementById('selectComuna').innerHTML = '<option value="">Seleccione comuna</option>';
                }
            });
        });

        // Función para cargar comunas según región seleccionada
        function cargarComunas(region) {
            const selectComuna = document.getElementById('selectComuna');
            selectComuna.innerHTML = '<option value="">Seleccione comuna</option>';
            
            if (regionesComunas[region]) {
                regionesComunas[region].forEach(comuna => {
                    const option = document.createElement('option');
                    option.value = comuna;
                    option.textContent = comuna;
                    selectComuna.appendChild(option);
                });
            }
        }</script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js" integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y" crossorigin="anonymous"></script>
    </body>
</html>